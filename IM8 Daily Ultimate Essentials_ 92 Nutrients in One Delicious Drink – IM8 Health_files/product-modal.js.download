customElements.get("product-modal")||customElements.define("product-modal",class extends ModalDialog{constructor(){super(),this.initializeSlideReady=this.initializeSlideReady.bind(this),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",this.initializeSlideReady):setTimeout(this.initializeSlideReady,100)}hide(){super.hide()}show(opener){super.show(opener),this.masterPresizeSystem(opener),this.showActiveMedia(),this.initializeSwiperHandlers(),setTimeout(()=>{console.log("DELAYED PRESIZE 1: 50ms after modal open"),this.masterPresizeSystem(opener)},50),setTimeout(()=>{console.log("DELAYED PRESIZE 2: 150ms after modal open"),this.masterPresizeSystem(opener)},150),setTimeout(()=>{console.log("DELAYED PRESIZE 3: 300ms after modal open"),this.masterPresizeSystem(opener)},300)}masterPresizeSystem(opener){const popupSlider=document.querySelector(".Product_popup_slider");if(!popupSlider){console.log("MASTER: Popup slider not found, skipping");return}const targetMediaId=opener?opener.getAttribute("data-media-id"):null;console.log(`MASTER: Presize system - media ID: ${targetMediaId}`);const allSlides=popupSlider.querySelectorAll(".swiper-slide"),isMobile=window.innerWidth<=749;if(allSlides.length===0){console.log("MASTER: No slides found, will retry");return}let foundEnlargedSlide=!1;allSlides.forEach((slide,index)=>{const slideMediaId=slide.querySelector("[data-media-id]")?.getAttribute("data-media-id"),img=slide.querySelector("img");if(!img)return;if(img.classList.contains("global-media-settings--supplement-enlarged")&&(targetMediaId?slideMediaId===targetMediaId:index===0)){foundEnlargedSlide=!0;let targetHeight=isMobile?"83vh":"95vh";if(isMobile){const vhInPixels=window.innerHeight*.83;targetHeight=`${Math.max(535,Math.min(vhInPixels,620))}px`}slide.style.setProperty("height",targetHeight,"important"),img.style.setProperty("object-fit","cover","important"),img.style.setProperty("object-position","center","important"),img.style.setProperty("width","100%","important"),img.style.setProperty("height","100%","important"),img.style.setProperty("max-width","100%","important"),img.style.setProperty("max-height","100%","important"),slide.style.setProperty("padding","0","important"),slide.style.setProperty("box-sizing","border-box","important"),console.log(`MASTER: \u2705 ENLARGED slide ${index} sized to ${targetHeight} (media: ${slideMediaId})`)}else this.applyNormalSizing(slide,img),console.log(`MASTER: Normal slide ${index} sized (media: ${slideMediaId})`)}),console.log(foundEnlargedSlide?"MASTER: \u2705 Successfully found and sized enlarged slide":"MASTER: \u26A0\uFE0F No enlarged slide found for this media ID"),popupSlider.swiper&&(popupSlider.swiper.updateSize(),popupSlider.swiper.updateSlides())}applyNormalSizing(slide,img){const calculateHeight=()=>{if(img.naturalWidth&&img.naturalHeight){const aspectRatio=img.naturalWidth/img.naturalHeight;let calculatedHeight=(slide.offsetWidth||window.innerWidth*.9)/aspectRatio;const minHeight=window.innerHeight*.3,maxHeight=window.innerHeight*.7;calculatedHeight=Math.max(minHeight,Math.min(calculatedHeight,maxHeight)),slide.style.setProperty("height",`${calculatedHeight}px`,"important"),img.style.setProperty("object-fit","contain","important"),img.style.setProperty("object-position","center","important"),img.style.setProperty("width","100%","important"),img.style.setProperty("height","100%","important"),img.style.setProperty("max-width","100%","important"),img.style.setProperty("max-height","100%","important"),slide.style.setProperty("padding","0","important"),slide.style.setProperty("box-sizing","border-box","important")}};img.complete&&img.naturalWidth?calculateHeight():img.onload=calculateHeight}showActiveMedia(){const targetMediaId=this.openedBy?.getAttribute("data-media-id"),isQuarterlyAlt=targetMediaId&&targetMediaId.includes("quarterly-alt");console.log("showActiveMedia - targetMediaId:",targetMediaId,"isQuarterlyAlt:",isQuarterlyAlt),this.querySelectorAll(`[data-media-id]:not([data-media-id="${targetMediaId}"])`).forEach(element=>{element.classList.remove("active")});let activeMedia;if(isQuarterlyAlt){const quarterlySlide=this.querySelector('[data-quarterly-alt-popup-slide="true"]');console.log("Looking for quarterly popup slide, found:",!!quarterlySlide);const mediaIdElement=this.querySelector(`[data-media-id="${targetMediaId}"]`);console.log("Looking for element with data-media-id, found:",!!mediaIdElement),activeMedia=quarterlySlide||mediaIdElement}else activeMedia=this.querySelector(`[data-media-id="${targetMediaId}"]`);if(activeMedia||(console.log("SHOWACTIVEMEDIA: Active media not found, trying first slide"),activeMedia=this.querySelector(".swiper-slide")),!activeMedia){console.log("SHOWACTIVEMEDIA: No media found at all");return}console.log("SHOWACTIVEMEDIA: Found activeMedia:",activeMedia);const activeMediaTemplate=activeMedia.querySelector("template"),activeMediaContent=activeMediaTemplate?activeMediaTemplate.content:null;activeMedia.classList.add("active");const popupSlider=document.querySelector(".Product_popup_slider");popupSlider&&(this.hideNonActiveSlides(popupSlider),this.activateCorrectSlide(popupSlider),console.log("SHOWACTIVEMEDIA: Applying master presizing after modal content processed"),this.masterPresizeSystem(this.openedBy),this.ensureConsistentTogglePosition(),setTimeout(()=>{console.log("SHOWACTIVEMEDIA: Delayed presizing at 100ms"),this.masterPresizeSystem(this.openedBy),this.validateSlideLayout(popupSlider)},100),setTimeout(()=>{console.log("SHOWACTIVEMEDIA: Final presizing at 300ms"),this.masterPresizeSystem(this.openedBy),this.validateSlideLayout(popupSlider)},300)),activeMedia.scrollIntoView();const container=this.querySelector('[role="document"]');container.scrollLeft=(activeMedia.width-container.clientWidth)/2,activeMedia.nodeName=="DEFERRED-MEDIA"&&activeMediaContent&&activeMediaContent.querySelector(".js-youtube")&&activeMedia.loadContent()}activateCorrectSlide(popupSlider){const allSlides=popupSlider.querySelectorAll(".swiper-slide"),targetMediaId=this.openedBy?.getAttribute("data-media-id");console.log("activateCorrectSlide - targetMediaId:",targetMediaId),allSlides.forEach(slide=>{slide.classList.remove("active")});const isQuarterlyAlt=targetMediaId&&targetMediaId.includes("quarterly-alt");let activeSlide=null;if(isQuarterlyAlt&&(activeSlide=popupSlider.querySelector('[data-quarterly-alt-popup-slide="true"]'),console.log("Looking for quarterly alt slide, found:",!!activeSlide)),activeSlide||(activeSlide=Array.from(allSlides).find(slide=>{const childMediaId=slide.querySelector("[data-media-id]")?.getAttribute("data-media-id"),slideMediaId=slide.getAttribute("data-media-id"),match=childMediaId===targetMediaId||slideMediaId===targetMediaId;return match&&console.log("Found matching slide with mediaId:",childMediaId||slideMediaId),match})),activeSlide){if(activeSlide.classList.add("active"),console.log("Activated slide:",activeSlide),popupSlider.swiper){const slideIndex=Array.from(allSlides).indexOf(activeSlide);console.log("Sliding to index:",slideIndex),popupSlider.swiper.slideTo(slideIndex,0)}}else{console.log("No matching slide found, using fallback");const firstVisibleSlide=Array.from(allSlides).find(slide=>slide.style.display!=="none");if(firstVisibleSlide&&(firstVisibleSlide.classList.add("active"),popupSlider.swiper)){const slideIndex=Array.from(allSlides).indexOf(firstVisibleSlide);popupSlider.swiper.slideTo(slideIndex,0)}}}ensureConsistentTogglePosition(){const toggle=this.querySelector(".product-media-modal__toggle");toggle&&(toggle.style.setProperty("position","absolute","important"),toggle.style.setProperty("top","-24px","important"),toggle.style.setProperty("right","16px","important"),toggle.style.setProperty("z-index","999","important"))}validateSlideLayout(popupSlider){const allSlides=popupSlider.querySelectorAll(".swiper-slide"),activeSlide=popupSlider.querySelector(".swiper-slide.active"),isMobile=window.innerWidth<=749;if(activeSlide){if(allSlides.forEach(slide=>{slide===activeSlide?(slide.style.setProperty("visibility","visible","important"),slide.style.setProperty("opacity","1","important"),slide.style.setProperty("display","flex","important")):(slide.style.setProperty("visibility","hidden","important"),slide.style.setProperty("opacity","0","important"))}),isMobile){const img=activeSlide.querySelector("img");if(img&&img.classList.contains("global-media-settings--supplement-enlarged")){const vhInPixels=window.innerHeight*.83,constrainedHeight=Math.max(535,Math.min(vhInPixels,620));activeSlide.style.setProperty("height",`${constrainedHeight}px`,"important"),activeSlide.style.setProperty("transform","none","important"),activeSlide.style.setProperty("left","0","important"),activeSlide.style.setProperty("margin-left","0","important"),activeSlide.style.setProperty("margin-right","0","important"),activeSlide.style.setProperty("width","100%","important"),activeSlide.style.setProperty("flex-shrink","0","important"),console.log(`Applied mobile positioning fixes for enlarged image with constrained height: ${constrainedHeight}px`)}}if(popupSlider.swiper){const slideIndex=Array.from(allSlides).indexOf(activeSlide);popupSlider.swiper.slideTo(slideIndex,0),isMobile&&setTimeout(()=>{popupSlider.swiper.updateSize(),popupSlider.swiper.updateSlides(),popupSlider.swiper.slideTo(slideIndex,0)},50)}}}updateSwiperLayout(popupSlider){window.Swiper&&popupSlider&&popupSlider.swiper&&(popupSlider.swiper.updateSize(),popupSlider.swiper.updateSlides(),popupSlider.swiper.update())}initializeSwiperHandlers(){const popupSlider=document.querySelector(".Product_popup_slider");if(!popupSlider)return;const waitForSwiper=()=>{window.Swiper&&popupSlider.swiper?this.setupSwiperEvents(popupSlider):setTimeout(waitForSwiper,100)};window.Swiper&&popupSlider.swiper?this.setupSwiperEvents(popupSlider):waitForSwiper()}setupSwiperEvents(popupSlider){const swiper=popupSlider.swiper;this.swiperSlideChangeHandler&&swiper.off("slideChange",this.swiperSlideChangeHandler),this.swiperSlideChangeHandler=()=>{this.handleSwiperSlideChange(popupSlider)},swiper.on("slideChange",this.swiperSlideChangeHandler),console.log("Swiper event handlers initialized")}handleSwiperSlideChange(popupSlider){const swiper=popupSlider.swiper,activeSlideIndex=swiper.activeIndex,allSlides=popupSlider.querySelectorAll(".swiper-slide");allSlides.forEach(slide=>{slide.classList.remove("active")});const currentSlide=allSlides[activeSlideIndex];if(currentSlide){currentSlide.classList.add("active");const hasSupplementEnlarged=currentSlide.querySelector("img.global-media-settings--supplement-enlarged"),isMobile=window.innerWidth<=749;if(console.log(`Slide changed to index ${activeSlideIndex}, enlarged: ${!!hasSupplementEnlarged}, mobile: ${isMobile}`),isMobile&&hasSupplementEnlarged){const vhInPixels=window.innerHeight*.83,constrainedHeight=Math.max(535,Math.min(vhInPixels,620));currentSlide.style.setProperty("height",`${constrainedHeight}px`,"important"),currentSlide.style.setProperty("transform","translateX(0px)","important"),currentSlide.style.setProperty("left","0","important"),currentSlide.style.setProperty("margin","0","important"),swiper.updateSize(),swiper.updateSlides()}this.masterPresizeSystem(null),this.ensureConsistentTogglePosition(),setTimeout(()=>{this.validateSlideLayout(popupSlider)},150)}}hideNonActiveSlides(popupSlider){const slides=popupSlider.querySelectorAll(".swiper-slide"),swiper=popupSlider.swiper;if(swiper&&typeof swiper.activeIndex<"u"){const activeIndex=swiper.activeIndex;slides.forEach((slide,index)=>{slide.classList.remove("swiper-slide-active","swiper-slide-next","swiper-slide-prev"),index===activeIndex?(slide.classList.add("swiper-slide-active"),slide.style.removeProperty("visibility"),slide.style.removeProperty("opacity"),slide.style.removeProperty("display")):slide.classList.remove("swiper-slide-active")}),swiper.updateSlidesClasses&&swiper.updateSlidesClasses(),console.log(`Updated slide visibility - active slide: ${activeIndex}`)}else slides.forEach((slide,index)=>{index===0?(slide.classList.add("swiper-slide-active"),slide.style.removeProperty("visibility"),slide.style.removeProperty("opacity"),slide.style.removeProperty("display")):slide.classList.remove("swiper-slide-active")}),console.log("Swiper not ready, showing first slide as fallback")}initializeSlideReady(){const popupSlider=document.querySelector(".Product_popup_slider");popupSlider&&(console.log("Component: Initializing with master presize system"),this.masterPresizeSystem(null),setTimeout(()=>{popupSlider.querySelector(".Product_popup_slider")&&this.masterPresizeSystem(null)},1e3))}resetTogglePosition(){this.ensureConsistentTogglePosition()}});
//# sourceMappingURL=/cdn/shop/t/121/assets/product-modal.js.map?v=111590159012861533831764243457
