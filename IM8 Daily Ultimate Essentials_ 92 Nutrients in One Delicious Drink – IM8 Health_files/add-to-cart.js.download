class AddToCart extends HTMLElement{constructor(){super(),this.cart=document.querySelector("cart-drawer"),this.spinnerEl=this.querySelector(".loading__spinner"),this.cartRemoveButton=this.cart.querySelectorAll("cart-remove-button button"),this.init()}init(){this.addEventListener("click",this.handleAddToCart.bind(this))}async handleAddToCart({currentTarget}){toggleCartState(!0),this.spinnerEl.classList.remove("hidden");const variantId=currentTarget.getAttribute("data-variant-id"),upgradePurchase=currentTarget.getAttribute("data-upgrade-purchase"),selling_plan_id=currentTarget.getAttribute("data-selling-plan-id"),quantity=currentTarget.getAttribute("data-quantity");try{upgradePurchase&&await this.removeNutritionVariants();const body=JSON.stringify({items:[{id:variantId,quantity,...upgradePurchase?{selling_plan:selling_plan_id}:{}}],sections:this.cart.getSectionsToRender().map(section=>section.id),sections_url:window.location.pathname}),state=await(await fetch(`${routes.cart_add_url}`,{...fetchConfig(),body})).text(),parsedState=JSON.parse(state);variantId&&productToGiftMap[variantId]?await addGiftItems(variantId,quantity):this.cart.renderContents(parsedState),window.location.href="/checkout"}catch(error){console.error("Error updating the cart:",error)}finally{this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.spinnerEl.classList.add("hidden")}}async removeNutritionVariants(){const existingLineItemsToRemove=this.cart.querySelector(".cart-complete-set").dataset.stackLineItems.split(",").filter(Boolean),variantsToRemoveMap={};for(const variantId of existingLineItemsToRemove)variantsToRemoveMap[variantId]=0;try{const state=await(await fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:JSON.stringify({updates:variantsToRemoveMap})})).text(),parsedState=JSON.parse(state);publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-upsell-remove-nutrition",cartData:parsedState,eventType:EVENT_TYPE.quantityChanged})}catch(error){console.error("Error removing variants",error)}}}customElements.define("add-to-cart",AddToCart);
//# sourceMappingURL=/cdn/shop/t/121/assets/add-to-cart.js.map?v=11183924730705705911732599606
