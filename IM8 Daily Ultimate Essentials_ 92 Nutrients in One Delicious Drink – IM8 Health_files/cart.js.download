class CartRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",event=>{if(event.preventDefault(),document&&document.documentElement&&document.documentElement.dataset.cartUpdating==="true")return;(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0)})}}customElements.define("cart-remove-button",CartRemoveButton);class CartSubscriptionButton extends HTMLElement{constructor(){super(),this.addEventListener("click",async()=>{const cartItems=this.closest("cart-items")||this.closest("cart-drawer-items"),cartDrawer=this.closest("cart-drawer"),line=parseInt(this.dataset.index),quantity=parseInt(this.dataset.quantity),variantId=this.dataset.variantId,sellingPlanId=this.dataset.sellingPlanId;cartItems.enableLoading(line),toggleCartState(!0);try{await fetch(`${routes.cart_change_url}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line,quantity:0})});const sections=cartItems.getSectionsToRender().map(section=>section.section),responseText=await(await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{id:variantId,quantity,selling_plan:sellingPlanId}],sections,sections_url:window.location.pathname})})).text(),parsedState=JSON.parse(responseText);cartDrawer&&typeof cartDrawer.renderContents=="function"&&cartDrawer.renderContents(parsedState)}catch(error){console.error("Error upgrading to subscription:",error),cartItems.disableLoading(line)}finally{toggleCartState(!1)}})}}customElements.define("subcription-btn",CartSubscriptionButton);class CartItemsUpgrade extends HTMLElement{constructor(){super(),this.button=this.querySelector("#upgrade-all-button"),this.button.addEventListener("click",this.upgradeAllToSubscriptions.bind(this)),this.cartDrawer=this.closest("cart-drawer"),this.spinnerEl=this.button.querySelector(".loading__spinner")}parseUpgradableItems(){const rawData=this.dataset.upgradableItems;return rawData?rawData.split("|").filter(Boolean).map(item=>{const[line,quantity,sellingPlanId,variantId,removeVariantId]=item.split(",");return{line:parseInt(line,10),quantity:parseInt(quantity,10),sellingPlanId,variantId,removeVariantId}}):(console.error("No upgradable items found."),[])}async upgradeAllToSubscriptions(event){event.preventDefault(),toggleCartState(!0),this.button.disabled=!0,this.spinnerEl.classList.remove("hidden");const upgradableItems=this.parseUpgradableItems();if(!upgradableItems.length){console.log("No upgradable items found."),this.button.disabled=!1,this.spinnerEl.classList.add("hidden"),toggleCartState(!1);return}try{for(const item of upgradableItems){this.showLoading(),await this.changeCart(item.removeVariantId,0);const responseText=await(await this.addToCart(item.variantId,item.quantity,item.sellingPlanId)).text(),parsedState=JSON.parse(responseText);item.variantId&&productToGiftMap[item.variantId]?await addGiftItems(item.variantId,item.quantity):this.cartDrawer.renderContents(parsedState)}window.location.href="/checkout"}catch(error){console.error("Error upgrading items:",error)}finally{this.button.disabled=!1,this.spinnerEl.classList.add("hidden"),this.showLoading()}}showLoading(){this.cartDrawer.querySelectorAll("cart-drawer-items .cart-item").forEach(item=>item.classList.add("is-loading"))}async changeCart(removeVariantId,quantity){const currentLineItem=Array.from(this.cartDrawer.querySelectorAll("cart-drawer-items tr")).findIndex(item=>item.dataset.variantId===removeVariantId);return this.sendRequest(`${routes.cart_change_url}`,{line:parseInt(currentLineItem,10),quantity:parseInt(quantity,10)})}async addToCart(variantId,quantity,sellingPlanId){try{const response=await this.sendRequest(`${routes.cart_add_url}`,{id:parseInt(variantId,10),quantity:parseInt(quantity,10),selling_plan:parseInt(sellingPlanId,10)});if(!response.ok)throw new Error(`Cart add failed with status ${response.status}: ${response.statusText}`);return response}catch(error){throw console.error("Error adding item to cart:",error),console.error("Variant ID:",variantId,"Quantity:",quantity,"Selling Plan ID:",sellingPlanId),error}}async sendRequest(url,payload){try{return fetch(url,{...fetchConfig(),body:JSON.stringify({...payload})})}catch(error){console.error(`Error sending request to ${url}:`,error)}}}customElements.define("cart-items-upgrade",CartItemsUpgrade);class QuarterlyUpgrade extends HTMLElement{constructor(){super(),this.button=this.querySelector(".quarterly-upgrade-button"),this.cartDrawer=this.closest("cart-drawer"),this.spinnerEl=this.button?.querySelector(".loading__spinner"),this.button&&this.button.addEventListener("click",this.upgradeToQuarterly.bind(this))}async upgradeToQuarterly(event){event.preventDefault();const itemIndex=this.dataset.itemIndex,itemQuantity=parseInt(this.dataset.itemQuantity,10),currentVariantId=this.dataset.currentVariantId,quarterlyVariantId=this.dataset.quarterlyVariantId,sellingPlanId=this.dataset.sellingPlanId;if(!quarterlyVariantId||!sellingPlanId){console.error("Quarterly upgrade: Missing required data attributes");return}toggleCartState(!0),this.button.disabled=!0,this.spinnerEl&&this.spinnerEl.classList.remove("hidden"),this.showLoading();try{console.log("Quarterly upgrade: Removing line",itemIndex,"(variant",currentVariantId,")");const removeResponse=await this.removeByLine(parseInt(itemIndex,10),0);if(removeResponse&&!removeResponse.ok){console.error("Quarterly upgrade: Failed to remove item, status:",removeResponse.status);const errorText=await removeResponse.text();throw console.error("Quarterly upgrade: Error response:",errorText),new Error("Failed to remove monthly subscription")}await new Promise(resolve=>setTimeout(resolve,100)),console.log("Quarterly upgrade: Adding quarterly variant",quarterlyVariantId,"quantity",itemQuantity);const addResponse=await this.addToCart(quarterlyVariantId,itemQuantity,sellingPlanId);if(!addResponse.ok)throw new Error(`Failed to add quarterly variant: ${addResponse.status}`);const responseText=await addResponse.text(),parsedState=JSON.parse(responseText);quarterlyVariantId&&typeof productToGiftMap<"u"&&productToGiftMap[quarterlyVariantId]?await addGiftItems(quarterlyVariantId,itemQuantity):this.cartDrawer&&typeof this.cartDrawer.renderContents=="function"&&this.cartDrawer.renderContents(parsedState),console.log("Successfully upgraded to quarterly subscription")}catch(error){console.error("Error upgrading to quarterly subscription:",error),this.button.disabled=!1,this.spinnerEl&&this.spinnerEl.classList.add("hidden")}finally{toggleCartState(!1)}}showLoading(){this.cartDrawer?.querySelectorAll("cart-drawer-items .cart-item")?.forEach(item=>item.classList.add("is-loading"))}async removeByLine(lineNumber,quantity){return console.log("Quarterly upgrade: Sending remove request for line",lineNumber),this.sendRequest(`${routes.cart_change_url}`,{line:lineNumber,quantity:parseInt(quantity,10)})}async changeCart(removeVariantId,quantity){const cartDrawerItems=Array.from(this.cartDrawer?.querySelectorAll("cart-drawer-items tr.cart-item")||[]),currentLineItem=cartDrawerItems.findIndex(item=>item.dataset.variantId===removeVariantId);return console.log("Quarterly upgrade: Looking for variant",removeVariantId,"in",cartDrawerItems.length,"items"),console.log("Quarterly upgrade: Found at index",currentLineItem),currentLineItem===-1?(console.warn("Quarterly upgrade: Could not find line item to remove, trying by ID directly"),this.sendRequest(`${routes.cart_change_url}`,{id:removeVariantId,quantity:parseInt(quantity,10)})):this.sendRequest(`${routes.cart_change_url}`,{line:currentLineItem+1,quantity:parseInt(quantity,10)})}async addToCart(variantId,quantity,sellingPlanId){return this.sendRequest(`${routes.cart_add_url}`,{id:parseInt(variantId,10),quantity:parseInt(quantity,10),selling_plan:parseInt(sellingPlanId,10)})}async sendRequest(url,payload){try{return fetch(url,{...fetchConfig(),body:JSON.stringify(payload)})}catch(error){throw console.error(`Quarterly upgrade: Error sending request to ${url}:`,error),error}}}customElements.define("quarterly-upgrade",QuarterlyUpgrade);class CartSubscriptionFrequencyButton extends HTMLElement{constructor(){super(),this.cartDrawer=this.closest("cart-drawer"),this.selectBtn=this.querySelector("[js-subscription-btn]"),this.purchaseOptions=this.querySelectorAll("[js-purchase-option]"),this.selectBtn&&this.selectBtn.addEventListener("click",()=>{this.classList.toggle("is-open")}),this.purchaseOptions.forEach(optionEl=>{optionEl.addEventListener("click",({currentTarget})=>{(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(currentTarget.dataset.index,currentTarget.dataset.quantity,null,null,currentTarget.dataset.sellingPlanId),this.classList.remove("is-open")})}),this.cartDrawer.addEventListener("click",event=>{event.target.classList.contains("subscription-select")||this.classList.remove("is-open")})}}customElements.define("subcription-frequency",CartSubscriptionFrequencyButton);class CartReviewsVideo extends HTMLElement{constructor(){super(),this.cartDrawer=this.closest("cart-drawer"),this.cartDrawer.querySelectorAll(".cart_drawer_people_popup_open").forEach(element=>{element.addEventListener("click",this.playVideo.bind(this,element))}),this.cartDrawer.querySelectorAll(".cart_drawer_meta_real_reviews_mainclose_new").forEach(element=>{element.addEventListener("click",this.closeVideo.bind(this))}),this.cartDrawer.querySelectorAll(".mute_video_popup").forEach(element=>{element.addEventListener("click",this.muteVideo.bind(this,element))}),this.cartDrawer.querySelectorAll(".unmute_video_popup").forEach(element=>{element.addEventListener("click",this.unmuteVideo.bind(this,element))})}playVideo(element){var video_id=element.getAttribute("video_id");if(video_id){this.cartDrawer.querySelector(`.${video_id}_open`).style.display="block",this.cartDrawer.querySelector(".cart_drawer_people_popup_overlay_new").style.display="block",document.body.classList.add("overflow-hidden");var URL=this.cartDrawer.querySelector(`.${video_id}_open video`).getAttribute("video_url");this.cartDrawer.querySelector(`.${video_id}_open video`).getAttribute("src")==null&&this.cartDrawer.querySelector(`.${video_id}_open video`).setAttribute("src",URL),this.cartDrawer.querySelector(`.${video_id}_open video`).play(),this.cartDrawer.querySelector(`.${video_id}_open .video_play_icon_new`).classList.add("active"),this.querySelector(`.${video_id}_open svg.play_icon`).style.display="none",document.body.classList.remove("overflow-hidden")}}closeVideo(){const videoReviewContainer=document.querySelector(".meta_real_reviews_video_main_new");videoReviewContainer&&videoReviewContainer.querySelectorAll(".cart_drawer_meta_real_reviews_mainpopup_new").forEach(videoPopup=>{videoPopup.style.display==="block"&&(videoPopup.querySelector(".video_play_icon_new").classList.remove("active"),videoPopup.querySelector(".cart_drawer_popup_video").pause(),videoPopup.style.display="none",document.querySelector(".cart_drawer_people_popup_overlay_new").style.display="none")})}muteVideo(element){element.classList.remove("active"),element.parentElement.parentElement.querySelector(".unmute_video_popup").classList.add("active"),element.parentElement.parentElement.querySelector(".cart_drawer_popup_video").muted=!0}unmuteVideo(element){element.classList.remove("active"),element.parentElement.parentElement.querySelector(".mute_video_popup").classList.add("active"),element.parentElement.parentElement.querySelector(".cart_drawer_popup_video").muted=!1}}customElements.define("cart-reviews-video",CartReviewsVideo);class CartItems extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const debouncedOnChange=debounce(event=>{this.onChange(event)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",debouncedOnChange.bind(this))}cartUpdateUnsubscriber=void 0;connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,event=>{if(event.source==="cart-items"){updateFreeShippingText();return}this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}resetQuantityInput(id){const input=this.querySelector(`#Quantity-${id}`);input.value=input.getAttribute("value"),this.isEnterPressed=!1}setValidity(event,index,message){event.target.setCustomValidity(message),event.target.reportValidity(),this.resetQuantityInput(index),event.target.select()}validateQuantity(event){const inputValue=parseInt(event.target.value),index=event.target.dataset.index;let message="";inputValue<event.target.dataset.min?message=window.quickOrderListStrings.min_error.replace("[min]",event.target.dataset.min):inputValue>parseInt(event.target.max)?message=window.quickOrderListStrings.max_error.replace("[max]",event.target.max):inputValue%parseInt(event.target.step)!==0&&(message=window.quickOrderListStrings.step_error.replace("[step]",event.target.step)),message?this.setValidity(event,index,message):(event.target.setCustomValidity(""),event.target.reportValidity(),this.updateQuantity(index,inputValue,document.activeElement.getAttribute("name"),event.target.dataset.quantityVariantId))}onChange(event){this.validateQuantity(event)}onCartUpdate(){this.tagName==="CART-DRAWER-ITEMS"?fetch(`${routes.cart_url}?section_id=cart-drawer`).then(response=>response.text()).then(responseText=>{const html=new DOMParser().parseFromString(responseText,"text/html"),selectors=["cart-drawer-items",".cart-drawer__footer"];for(const selector of selectors){const targetElement=document.querySelector(selector),sourceElement=html.querySelector(selector);targetElement&&sourceElement&&targetElement.replaceWith(sourceElement)}}).catch(e=>{console.error(e)}):fetch(`${routes.cart_url}?section_id=main-cart-items`).then(response=>response.text()).then(responseText=>{const sourceQty=new DOMParser().parseFromString(responseText,"text/html").querySelector("cart-items");this.innerHTML=sourceQty.innerHTML}).catch(e=>{console.error(e)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(line,quantity,name,variantId,selling_plan){this.enableLoading(line),toggleCartState(!0);const cartItem=document.getElementById(`CartDrawer-Item-${line}`),quantityElement=document.getElementById(`Drawer-quantity-${line}`);if(cartItem&&quantityElement){const currentValue=parseInt(quantityElement.value);if(quantity>currentValue&&(cartItem.style.backgroundColor="rgba(80, 0, 11, 0.02)",cartItem.style.transition="background-color 0.3s ease",setTimeout(()=>{cartItem.style.backgroundColor="",setTimeout(()=>{cartItem.style.transition=""},300)},150)),quantity===0){cartItem.classList.add("removing");const staggerDelay=(document.querySelectorAll(".cart-item.removing").length-1)*80;staggerDelay>0&&(cartItem.style.animationDelay=`${staggerDelay}ms`)}}const lineItemObj={line,quantity,sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname,id:variantId};selling_plan!==void 0&&(lineItemObj.selling_plan=selling_plan);const body=JSON.stringify(lineItemObj);fetch(`${routes.cart_change_url}`,{...fetchConfig(),body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state),quantityElement2=document.getElementById(`Quantity-${line}`)||document.getElementById(`Drawer-quantity-${line}`),items=document.querySelectorAll(".cart-item");if(parsedState.errors){quantityElement2.value=quantityElement2.getAttribute("value"),this.updateLiveRegions(line,parsedState.errors);return}this.classList.toggle("is-empty",parsedState.item_count===0);const cartDrawerWrapper=document.querySelector("cart-drawer"),cartFooter=document.getElementById("main-cart-footer");cartFooter&&cartFooter.classList.toggle("is-empty",parsedState.item_count===0),cartDrawerWrapper&&cartDrawerWrapper.classList.toggle("is-empty",parsedState.item_count===0),this.getSectionsToRender().forEach(section=>{const elementToReplace=document.getElementById(section.id).querySelector(section.selector)||document.getElementById(section.id),progressBar=elementToReplace.querySelector(".cart-progress-bar");let progressBarState=null;if(progressBar){const progressMeter=progressBar.querySelector(".progress-meter"),progressIcon=progressBar.querySelector(".progress-icon"),progressMessage=progressBar.querySelector(".progress-message"),meterStyles=progressMeter?getComputedStyle(progressMeter):null,iconStyles=progressIcon?getComputedStyle(progressIcon):null;progressBarState={meterWidth:meterStyles?meterStyles.width:"0%",iconPosition:iconStyles?iconStyles.left:"0px",messageText:progressMessage?progressMessage.innerText:"",datasets:{cartTotal:progressBar.dataset.cartTotal,shippingThreshold:progressBar.dataset.shippingThreshold,currency:progressBar.dataset.currency,hasSubscriptionItems:progressBar.dataset.hasSubscriptionItems,applyShippingChecks:progressBar.dataset.applyShippingChecks}}}const isGoingEmpty=parsedState.item_count===0,wasEmpty=this.classList.contains("is-empty");isGoingEmpty&&!wasEmpty?(elementToReplace.style.transition="opacity 0.4s ease-out",elementToReplace.style.opacity="0",setTimeout(()=>{elementToReplace.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.section],section.selector),elementToReplace.style.opacity="1",setTimeout(()=>{elementToReplace.style.transition=""},400)},400)):(elementToReplace.style.transition="opacity 0.1s ease-out",elementToReplace.style.opacity="0.98",setTimeout(()=>{if(elementToReplace.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.section],section.selector),progressBarState&&!isGoingEmpty){const newProgressBar=elementToReplace.querySelector(".cart-progress-bar");if(newProgressBar){Object.assign(newProgressBar.dataset,progressBarState.datasets);const newProgressMeter=newProgressBar.querySelector(".progress-meter"),newProgressIcon=newProgressBar.querySelector(".progress-icon"),newTotal=parseFloat(parsedState.original_total_price)/100||0,threshold=parseFloat(progressBarState.datasets.shippingThreshold)||0,hasSubscriptionItems=parsedState.items.some(item=>item.selling_plan_allocation),progressPercentage=hasSubscriptionItems?100:Math.min(newTotal/threshold*100,100);if(newProgressMeter){const currentWidth=parseFloat(progressBarState.meterWidth);newProgressMeter.style.width=isNaN(currentWidth)?"0%":progressBarState.meterWidth,newProgressMeter.style.transition="none"}newProgressIcon&&(newProgressIcon.style.left=progressBarState.iconPosition,newProgressIcon.style.transition="none");const currentPercentage=parseFloat(progressBarState.meterWidth)||0;Math.abs(progressPercentage-currentPercentage)>1&&requestAnimationFrame(()=>{newProgressMeter&&(newProgressMeter.style.transition="width 0.4s cubic-bezier(0.4, 0.0, 0.2, 1)",newProgressMeter.style.width=`${progressPercentage}%`),newProgressIcon&&(newProgressIcon.style.transition="left 0.4s cubic-bezier(0.4, 0.0, 0.2, 1)",newProgressIcon.style.left=`calc(${progressPercentage}% - 8px)`),setTimeout(()=>{newProgressMeter&&(newProgressMeter.style.transition=""),newProgressIcon&&(newProgressIcon.style.transition="")},400)}),newProgressBar.dataset.cartTotal=newTotal.toString(),newProgressBar.dataset.hasSubscriptionItems=hasSubscriptionItems.toString()}}elementToReplace.style.opacity="1",setTimeout(()=>{elementToReplace.style.transition=""},100),updateFreeShippingText()},50))});const updatedValue=parsedState.items[line-1]?parsedState.items[line-1].quantity:void 0;let message="";items.length===parsedState.items.length&&updatedValue!==parseInt(quantityElement2.value)&&(typeof updatedValue>"u"?message=window.cartStrings.error:message=window.cartStrings.quantityError.replace("[quantity]",updatedValue)),this.updateLiveRegions(line,message);const lineItem=document.getElementById(`CartItem-${line}`)||document.getElementById(`CartDrawer-Item-${line}`);lineItem&&lineItem.querySelector(`[name="${name}"]`)?cartDrawerWrapper?trapFocus(cartDrawerWrapper,lineItem.querySelector(`[name="${name}"]`)):lineItem.querySelector(`[name="${name}"]`).focus():parsedState.item_count===0&&cartDrawerWrapper?trapFocus(cartDrawerWrapper.querySelector(".drawer__inner-empty"),cartDrawerWrapper.querySelector("a")):document.querySelector(".cart-item")&&cartDrawerWrapper&&trapFocus(cartDrawerWrapper,document.querySelector(".cart-item__name")),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:parsedState,variantId,eventType:EVENT_TYPE.quantityChanged})}).catch(()=>{this.querySelectorAll(".loading__spinner").forEach(overlay=>overlay.classList.add("hidden"));const errors=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");errors.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(line),toggleCartState(!1)})}updateLiveRegions(line,message){const lineItemError=document.getElementById(`Line-item-error-${line}`)||document.getElementById(`CartDrawer-LineItemError-${line}`);lineItemError&&(lineItemError.querySelector(".cart-item__error-text").textContent=message),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const cartStatus=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");cartStatus.setAttribute("aria-hidden",!1),setTimeout(()=>{cartStatus.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(html,selector){return new DOMParser().parseFromString(html,"text/html").querySelector(selector).innerHTML}enableLoading(line){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled"),document.getElementById(`CartDrawer-Item-${line}`)?.classList.add("is-loading");const cartItemElements=this.querySelectorAll(`#CartItem-${line} .loading__spinner`),cartDrawerItemElements=this.querySelectorAll(`#CartDrawer-Item-${line} .loading__spinner`);[...cartItemElements,...cartDrawerItemElements].forEach(overlay=>overlay.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(line){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const cartItemElements=this.querySelectorAll(`#CartItem-${line} .loading__spinner`),cartDrawerItemElements=this.querySelectorAll(`#CartDrawer-Item-${line} .loading__spinner`);cartItemElements.forEach(overlay=>overlay.classList.add("hidden")),cartDrawerItemElements.forEach(overlay=>overlay.classList.add("hidden"))}}customElements.define("cart-items",CartItems),customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("input",debounce(event=>{const body=JSON.stringify({note:event.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body})},ON_CHANGE_DEBOUNCE_TIMER))}});
//# sourceMappingURL=/cdn/shop/t/121/assets/cart.js.map?v=46717463915389673691764243453
