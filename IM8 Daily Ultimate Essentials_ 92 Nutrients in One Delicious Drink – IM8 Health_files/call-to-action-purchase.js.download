class CallToActionPurchase extends HTMLElement{constructor(){super(),this.cart=document.querySelector("cart-drawer"),this.spinnerEl=this.querySelector(".loading__spinner"),this.buttonLabel=this.querySelector(".btn-label"),this.init()}init(){this.addEventListener("click",this.handleAddToCart.bind(this,this))}async handleAddToCart(currentTarget){toggleCartState(!1),this.spinnerEl.classList.remove("hidden"),this.buttonLabel.style.display="none";let form;currentTarget.classList.contains("collection-quick-purchase")?form=currentTarget.parentElement.parentElement.parentElement.querySelector("product-form").querySelector("form"):form=document.querySelector("product-form").querySelector("form");const formData=new FormData(form);let sellingPlanFound=!1,variantId,selling_plan_id,quantity=1;for(const[key,value]of formData.entries())key==="selling_plan"?sellingPlanFound||(selling_plan_id=value,sellingPlanFound=!0):(key==="quantity"&&(quantity=value),key==="id"&&(variantId=value));try{const body=JSON.stringify({items:[{id:variantId,quantity,selling_plan:selling_plan_id}],sections:this.cart.getSectionsToRender().map(section=>section.id),sections_url:window.location.pathname}),state=await(await fetch(`${routes.cart_add_url}`,{...fetchConfig(),body})).text(),parsedState=JSON.parse(state);variantId&&productToGiftMap[variantId]?await addGiftItems(variantId,quantity):this.cart.renderContents(parsedState)}catch(error){console.error("Error updating the cart:",error)}finally{this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.spinnerEl.classList.add("hidden"),this.buttonLabel.style.display=""}}}customElements.define("call-to-action-purchase",CallToActionPurchase);
//# sourceMappingURL=/cdn/shop/t/121/assets/call-to-action-purchase.js.map?v=87274142242355326801751109505
