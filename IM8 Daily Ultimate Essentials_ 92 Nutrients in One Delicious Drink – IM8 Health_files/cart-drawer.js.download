class CartDrawer extends HTMLElement{constructor(){super(),this.addEventListener("keyup",evt=>evt.code==="Escape"&&this.close());const overlay=this.querySelector("#CartDrawer-Overlay");overlay&&!overlay.hasAttribute("data-listener-added")&&(overlay.addEventListener("click",this.close.bind(this)),overlay.setAttribute("data-listener-added","true")),this.setHeaderCartIconAccessibility()}async removeFreeGiftsWithoutEligibleProducts(){const cart=await this.fetchCartItems();cart.item_count>0&&await updateGiftItemQuantity(cart.items)}async fetchCartItems(){return(await fetch(`${routes.cart_url}`,{...fetchConfig(),method:"GET"})).json()}setHeaderCartIconAccessibility(){const cartLink=document.querySelector("#cart-icon-bubble");cartLink&&(cartLink.setAttribute("role","button"),cartLink.setAttribute("aria-haspopup","dialog"),cartLink.hasAttribute("data-cart-listeners-added")||(cartLink.addEventListener("click",event=>{event.preventDefault(),this.open(cartLink)}),cartLink.addEventListener("keydown",event=>{event.code.toUpperCase()==="SPACE"&&(event.preventDefault(),this.open(cartLink))}),cartLink.setAttribute("data-cart-listeners-added","true")))}open(triggeredBy){if(this.classList.contains("active")||this.classList.contains("opening"))return;triggeredBy&&this.setActiveElement(triggeredBy);const cartDrawerNote=this.querySelector('[id^="Details-"] summary');cartDrawerNote&&!cartDrawerNote.hasAttribute("role")&&this.setSummaryAccessibility(cartDrawerNote),this.style.display="flex",this.offsetHeight,this.classList.add("opening");const cartItems=this.querySelectorAll(".cart-item");cartItems.forEach((item,index)=>{item.style.opacity="0",item.style.transform="translateY(12px)",item.style.transition="opacity 0.3s ease, transform 0.3s ease",setTimeout(()=>{item.style.opacity="1",item.style.transform="translateY(0)"},80+index*30)}),requestAnimationFrame(()=>{this.classList.add("animate","active"),setTimeout(()=>{this.classList.remove("opening"),cartItems.forEach((item,index)=>{setTimeout(()=>{item.style.transition="",item.style.transform=""},300+index*30)})},50)}),this.addEventListener("transitionend",()=>{const containerToTrapFocusOn=this.classList.contains("is-empty")?this.querySelector(".drawer__inner-empty"):document.getElementById("CartDrawer"),focusElement=this.querySelector(".drawer__inner")||this.querySelector(".drawer__close");trapFocus(containerToTrapFocusOn,focusElement)},{once:!0}),this.savedScrollPosition=window.scrollY,document.body.style.top=`-${this.savedScrollPosition}px`,document.body.classList.add("overflow-hidden")}close(){if(this.classList.contains("closing")||!this.classList.contains("active"))return;try{if(document&&document.documentElement&&document.documentElement.dataset.cartUpdating==="true")return}catch{}const videoReviewContainer=document.querySelector(".meta_real_reviews_video_main_new");videoReviewContainer&&videoReviewContainer.querySelectorAll(".cart_drawer_meta_real_reviews_mainpopup_new").forEach(videoPopup=>{videoPopup.style.display==="block"&&(videoPopup.querySelector(".video_play_icon_new").classList.remove("active"),videoPopup.querySelector(".cart_drawer_popup_video").pause(),videoPopup.style.display="none",document.querySelector(".cart_drawer_people_popup_overlay_new").style.display="none")}),this.classList.add("closing"),this.classList.remove("active"),setTimeout(()=>{this.classList.remove("closing","animate"),this.style.display="",removeTrapFocus(this.activeElement),document.body.classList.remove("overflow-hidden"),document.body.style.top="",this.savedScrollPosition!==void 0&&window.scrollTo(0,this.savedScrollPosition)},250)}setSummaryAccessibility(cartDrawerNote){cartDrawerNote.setAttribute("role","button"),cartDrawerNote.setAttribute("aria-expanded","false"),cartDrawerNote.nextElementSibling.getAttribute("id")&&cartDrawerNote.setAttribute("aria-controls",cartDrawerNote.nextElementSibling.id),cartDrawerNote.addEventListener("click",event=>{event.currentTarget.setAttribute("aria-expanded",!event.currentTarget.closest("details").hasAttribute("open"))}),cartDrawerNote.parentElement.addEventListener("keyup",onKeyUpEscape)}renderContents(parsedState){this.querySelector(".drawer__inner").classList.contains("is-empty")&&this.querySelector(".drawer__inner").classList.remove("is-empty"),this.productId=parsedState.id,this.getSectionsToRender().forEach(section=>{const sectionElement=section.selector?document.querySelector(section.selector):document.getElementById(section.id);sectionElement&&(sectionElement.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.id],section.selector))}),this.querySelectorAll(".cart-item").length===0&&this.classList.add("is-empty");const isCurrentlyOpen=this.classList.contains("active");setTimeout(()=>{const overlay=this.querySelector("#CartDrawer-Overlay");overlay&&!overlay.hasAttribute("data-listener-added")&&(overlay.addEventListener("click",this.close.bind(this)),overlay.setAttribute("data-listener-added","true")),isCurrentlyOpen||this.open()}),updateFreeShippingText()}getSectionInnerHTML(html,selector=".shopify-section"){return new DOMParser().parseFromString(html,"text/html").querySelector(selector).innerHTML}getSectionsToRender(){return[{id:"cart-drawer",selector:"#CartDrawer"},{id:"cart-icon-bubble"}]}getSectionDOM(html,selector=".shopify-section"){return new DOMParser().parseFromString(html,"text/html").querySelector(selector)}setActiveElement(element){this.activeElement=element}}customElements.define("cart-drawer",CartDrawer);class CartDrawerItems extends CartItems{getSectionsToRender(){return[{id:"CartDrawer",section:"cart-drawer",selector:".drawer__inner"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"}]}}customElements.define("cart-drawer-items",CartDrawerItems);
//# sourceMappingURL=/cdn/shop/t/121/assets/cart-drawer.js.map?v=111144560566828945161767236034
